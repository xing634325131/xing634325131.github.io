<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="古古天" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="这里是古古天的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="古古天">
<meta property="og:url" content="http://blog.gugutian.com/index.html">
<meta property="og:site_name" content="古古天">
<meta property="og:description" content="这里是古古天的博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="古古天">
<meta name="twitter:description" content="这里是古古天的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.gugutian.com/"/>





  <title>古古天</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65425061-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?33f92b88fa5da2ab1d17e2a54d225a58";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">古古天</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'SDgAx7r-heZocnsHH6Lw','2.0.0');
</script>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2017/07/27/Meta annotation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/27/Meta annotation/" itemprop="url">Annotation-元注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-27T23:06:01+08:00">
                2017-07-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/27/Meta annotation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/07/27/Meta annotation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/07/27/Meta annotation/" class="leancloud_visitors" data-flag-title="Annotation-元注解">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h2><p>Java里面定义了4个标准的元注解:</p>
<ol>
<li>@Target</li>
<li>@Retention</li>
<li>@Documented</li>
<li>@Inherited</li>
</ol>
<p>这四个元注解的作用是负责注解其他注解，其他所有的注解都是通过元注解扩散开来。</p>
<h3 id="Target"><a href="#Target" class="headerlink" title="Target"></a><code>Target</code></h3><p>这个元注解的作用是负责指明注解的作用域。如果指明类型为<code>METHOD</code>，说明这个注解只能用在方法上面。<br>以下是可以指明<code>Target</code>的所有作用类型：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ElementType &#123;</div><div class="line">    ANNOTATION_TYPE,</div><div class="line">    CONSTRUCTOR,</div><div class="line">    FIELD,</div><div class="line">    LOCAL_VARIABLE,</div><div class="line">    METHOD,</div><div class="line">    PACKAGE,</div><div class="line">    PARAMETER,</div><div class="line">    TYPE,</div><div class="line">    TYPE_PARAMETER,</div><div class="line">    TYPE_USE;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ElementType</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Retention"><a href="#Retention" class="headerlink" title="Retention"></a><code>Retention</code></h3><p>这个元注解的作用是对Annotation的<code>作用时间</code>进行限制：某些Annotation仅出现在源代码中，而被编译器丢弃；而另一些却被编译在class文件中；编译在class文件中的Annotation可能会被虚拟机忽略，而另一些在class被装载时将被读取。<br>以下是可以指明<code>Retention</code>的所有作用类型：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RetentionPolicy &#123;</div><div class="line">    CLASS,</div><div class="line">    RUNTIME,</div><div class="line">    SOURCE;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">RetentionPolicy</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><code>RetentionPolicy.SOURCE</code>:在源文件中有效</li>
<li><code>RetentionPolicy.CLASS</code>:在class文件中有效</li>
<li><code>RetentionPolicy.RUNTIME</code>:在运行时有效</li>
</ul>
<h3 id="Documented"><a href="#Documented" class="headerlink" title="Documented"></a><code>Documented</code></h3><p>这个元注解的作用是标识是否能够在生成JavaDoc文档是，注解依然保存。这个只是一个标记注解，没有任何成员。<br>如下：<br>1.标记有<code>Documented</code>的Annotation与生成的JavaDoc文档<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Target</span>(ElementType.CONSTRUCTOR)</div><div class="line"><span class="meta">@Inherited</span></div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SourceAnnotation &#123;</div><div class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">age</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">gender</span><span class="params">()</span> <span class="keyword">default</span> "Male"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="/blog-img/annotation-person-documented.png" alt="annotation-person-documented"><br>2.没有标记的Annotation与生成的JavaDoc文档<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Target</span>(ElementType.CONSTRUCTOR)</div><div class="line"><span class="meta">@Inherited</span></div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SourceAnnotation &#123;</div><div class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">age</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">gender</span><span class="params">()</span> <span class="keyword">default</span> "Male"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="/blog-img/annotation-person-not-documented.png" alt="annotation-person-not-documented"></p>
<p>使用注解的类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="meta">@SourceAnnotation</span>(</div><div class="line">            name=<span class="string">"Person"</span>,</div><div class="line">            age=<span class="string">"1"</span></div><div class="line">    )</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Inherited"><a href="#Inherited" class="headerlink" title="Inherited"></a><code>Inherited</code></h3><p>这个元注解的作用是来阐述某个被标注的类型是可以被继承的。如果一个使用了@Inherited修饰的annotation类型被用于一个class，则这个annotation将被用于该class的子类。</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2016/09/11/Run for a better life/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/11/Run for a better life/" itemprop="url">Run for a better life</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-11T20:35:42+08:00">
                2016-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/11/Run for a better life/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/11/Run for a better life/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/09/11/Run for a better life/" class="leancloud_visitors" data-flag-title="Run for a better life">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文最初分享在<code>卡牛玩卡互助学堂</code>微信群，后期整理而成。</p>
<hr>
<p>我大概从高中起就有跑步的习惯，不过之前都是短距离慢跑，三五公里的样子，现在倾向于长跑（&gt;10km），时间足够的情况下长跑是很舒服的。</p>
<p><strong>关于呼吸</strong></p>
<p>一开始我也是用嘴呼吸的，后来别人看我跑起来总是气喘吁吁的，于是教我用鼻子呼吸，适应了几次后，我觉得这种方式非常好，呼吸起来有节奏感，跑起来也不感觉有那么累。上次焦总带来的教练也说了，用嘴或者用鼻子呼气都行，关键要有呼吸节奏。在没有加速的前提下，如果越跑呼吸越大，说明节奏是有问题的。</p>
<p><strong>关于跑步姿势</strong></p>
<p>头部不要前倾，目视前方，双肩放松，前后摆臂，前脚掌先落地，不要把力量集中在后脚跟，落地轻盈，膝盖处减少用力。跑步的姿势很重要，如果不对的话长时间跑步会对膝盖造成损伤。<br><img src="/blog-img/20160912-running-posture.png" alt="跑步姿势"></p>
<p><strong>关于跑步速度</strong></p>
<p>速度是跑步成绩的直接体现，刚开始时很多人关注速度胜过关注距离。我的经验是可以更多的关注距离、时间以及身体的感受。特别是对于初跑者，倾听身体的声音，更有利于提高成绩，跑步速度按照不会气喘，能正常交谈为宜。</p>
<p><strong>关于长距离跑</strong></p>
<p>其实跑步就是一项考验耐力的运动，就是身体承受力。如果节奏对了，身体又承受得起，一直跑下去都没有问题。不要在觉得很累的时候停下来，有时候跨过了这个很累的点，你又能多跑几公里，可以通过这样子锻炼自己的耐力。之前我很累的时候就是脚都几乎抬不起来了，以这样的方式坚持几分钟，会发现跑起来又轻松许多。LSD是长距离慢跑，这种方式也可以提高耐力，一般是20~35km。更多的跑者常见术语，可以<a href="http://mp.weixin.qq.com/s?__biz=MzA5ODE5MzkyNA==&amp;mid=2655241236&amp;idx=1&amp;sn=de94380ff62a3dc9a955ac9bff4d8127&amp;scene=0#wechat_redirect" target="_blank" rel="external">看这里</a></p>
<p><strong>关于装备</strong></p>
<p>对于装备控而言，装备不是表明要取得多好的成绩，而是表示坚持跑步的决心，只要决心有了，不用太烧装备，如果还没有决心，就通过烧装备建立吧。跑鞋是最基本的装备，既然不能通过成绩表明我们是个高手，那至少要用跑鞋证明我们是跑步爱好者。经济又实惠的跑鞋可以到迪卡侬购买，我现在穿的就是KALENJI系列的跑鞋，更专业的可以考虑asics跑鞋，价格略贵。</p>
<p>配速表和心率监控对于常跑者也是基本装备。心率可以通过心率带来监控，通过心率既能了解自己的身体状况，保证自己的安全，也能根据当前心率调整自己的跑步节奏。配速表的品牌就比较多了，Garmin是专业运动手表，SUnnto是专业户外品牌。我自己配备的是Garmin FENIX3HR，配备了光电心率功能，主要用于跑步、骑车和游泳。</p>
<p><strong>跑步也要量力而行，对于没有经常跑步的同学，一下子就跑得很远这样很容易受伤，之前跟我一起跑步的跑友就是因为这样子，跑了几次后脚疼，去医院看骨伤科，休养了几个月，现在才可以勉强跑起来。</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/11/09/Webview problem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/09/Webview problem/" itemprop="url">webview问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-09T17:35:42+08:00">
                2015-11-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/09/Webview problem/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/09/Webview problem/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/11/09/Webview problem/" class="leancloud_visitors" data-flag-title="webview问题">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.Uncaught ReferenceError: NPObject deleted<br>如果js注入遇到此类问题，无法执行，可以考虑一下是不是用了iframe框架导致的。</p>
<p>2.uri的<code>getQueryParameter()</code>引起的问题<br>用这个方法找寻url里面的参数时，最好检查一下该uri是否是<code>isHierarchical()</code>，不然会<code>throw new UnsupportedOperationException(NOT_HIERARCHICAL)</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/11/06/Chrome Customize UserAgent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/06/Chrome Customize UserAgent/" itemprop="url">Chrome自定义UserAgent</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-06T12:41:10+08:00">
                2015-11-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Chrome/" itemprop="url" rel="index">
                    <span itemprop="name">Chrome</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/06/Chrome Customize UserAgent/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/06/Chrome Customize UserAgent/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/11/06/Chrome Customize UserAgent/" class="leancloud_visitors" data-flag-title="Chrome自定义UserAgent">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>怎么样用Chrome实现自定义UserAgent呢</strong></p>
<p>目前我的Chrome版本为<code>44.0.2403.157 (64-bit)</code>，可以采用下面的方式实现：</p>
<p>1.点击右键－审查元素（<code>Ctrl+Shift+I</code>），调出调试界面，进入右上方的设置界面；</p>
<p><img src="/blog-img/20151106-custom-user-agent-1.png" alt="Custom-User-Agent"></p>
<p>2.设置页面有一个<code>Devices</code>选项，选择Add Custom device</p>
<p><img src="/blog-img/20151106-custom-user-agent-2.png" alt="Custom-User-Agent"></p>
<p>3.填入对应的信息保存就可以了．</p>
<p><img src="/blog-img/20151106-custom-user-agent-3.png" alt="Custom-User-Agent"></p>
<p>4.需要用该设备时，在调试页面的左上方选择你建立的Device就可以了</p>
<p><img src="/blog-img/20151106-custom-user-agent-4.png" alt="Custom-User-Agent"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/08/31/Customize the general steps of View/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/31/Customize the general steps of View/" itemprop="url">自定义View的一般步骤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-31T23:27:51+08:00">
                2015-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/31/Customize the general steps of View/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/31/Customize the general steps of View/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/08/31/Customize the general steps of View/" class="leancloud_visitors" data-flag-title="自定义View的一般步骤">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>自定义View应该是<code>Android开发</code>比较深入的内容，但又是在开发过程中必不可少的技能，总体来说，分为一下几步:</strong></p>
<ul>
<li>在attr.xml文件里声明自定义View需要用到的参数，这些参数也是可以在布局文件中直接使用；</li>
<li>布局文件中使用该View</li>
<li>构造方法中获取自定义属性</li>
<li>重写onMeasure()方法</li>
<li>重写layout()方法</li>
<li>重写onDraw()方法</li>
<li><p>如有需要继续重写View继承过来的其他方法,前面的步骤也不是全部必须的，应根据项目需求灵活使用</p>
<p><strong>下面以自定义QQ5.0主页菜单<code>SlidingMenu</code>为例，介绍自定义View，<a href="https://github.com/xing634325131/QQWapper" target="_blank" rel="external">项目Demo地址</a>：</strong></p>
</li>
</ul>
<p>1.如果没有attr.xml文件，可以建立<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"rightPadding"</span> <span class="attr">format</span>=<span class="string">"dimension"</span>&gt;</span><span class="tag">&lt;/<span class="name">attr</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"SlidingMenu"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"rightPadding"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><code>rightPadding</code>的含义为菜单展示时，菜单右侧距内容页面的距离</p>
<p>2.布局文件中使用该View<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:sliding</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/qq_com_bg_pic"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">com.gugutian.qqwapper.widget.SlidingMenu</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/main_sm"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">sliding:rightPadding</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/menu_main"</span>/&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/main_content_ly"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">                <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/main_content_fragment"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">com.gugutian.qqwapper.widget.SlidingMenu</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><code>SlidingMenu</code>为自定义View，包含了菜单页跟内容页，具体可以参考QQ5.0页面。<code>sliding:rightPadding=&quot;50dp&quot;</code>这里是使用自定义属性，前面记得还要声明该命名空间<code>xmlns:sliding=&quot;http://schemas.android.com/apk/res-auto&quot;</code></p>
<p>3.构造方法中获取自定义属性<br>具体获取自定义View的属性在携带三个参数的构造方法中<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SlidingMenu</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line"></div><div class="line">    WindowManager wm = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);</div><div class="line">    DisplayMetrics outMetrics = <span class="keyword">new</span> DisplayMetrics();</div><div class="line">    wm.getDefaultDisplay().getMetrics(outMetrics);</div><div class="line">    mScreenWidth = outMetrics.widthPixels;</div><div class="line"></div><div class="line">    mLeftMenuPaddingRight = (<span class="keyword">int</span>) TypedValue.applyDimension(</div><div class="line">        TypedValue.COMPLEX_UNIT_DIP,</div><div class="line">        mLeftMenuPaddingRight,</div><div class="line">        context.getResources().getDisplayMetrics());</div><div class="line"></div><div class="line">    TypedArray typedArray = context.getTheme().obtainStyledAttributes(attrs, R.styleable.SlidingMenu, defStyleAttr, <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, n = typedArray.getIndexCount(); i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">int</span> attr = typedArray.getIndex(i);</div><div class="line">        <span class="keyword">switch</span> (attr) &#123;</div><div class="line">            <span class="keyword">case</span> R.styleable.SlidingMenu_rightPadding:</div><div class="line">                mLeftMenuPaddingRight = typedArray.getDimensionPixelSize(attr, (<span class="keyword">int</span>)TypedValue.applyDimension(</div><div class="line">                        TypedValue.COMPLEX_UNIT_DIP,</div><div class="line">                        mLeftMenuPaddingRight,</div><div class="line">                        context.getResources().getDisplayMetrics()));</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    typedArray.recycle();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4.重写onMeasure()方法<br>该方法测绘及设定该<code>View</code>所有的<code>ChildView</code>的大小<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(!mOnce) &#123;</div><div class="line">        mWapper = (LinearLayout) getChildAt(<span class="number">0</span>);</div><div class="line">        mLeftMenuVg = (ViewGroup) mWapper.getChildAt(<span class="number">0</span>);</div><div class="line">        mMainContentVg = (ViewGroup) mWapper.getChildAt(<span class="number">1</span>);</div><div class="line">        mLeftMenuWidth = mLeftMenuVg.getLayoutParams().width = mScreenWidth - mLeftMenuPaddingRight;</div><div class="line">        mMainContentVg.getLayoutParams().width = mScreenWidth;</div><div class="line">        mOnce = !mOnce;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>5.重写layout()方法<br>设定该<code>View</code>所有<code>ChildView</code>的位置并在界面中展现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onLayout(changed, l, t, r, b);</div><div class="line">    <span class="keyword">if</span>(changed) &#123;</div><div class="line">        scrollTo(mLeftMenuWidth, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>6.其他</p>
<p><strong>下面是完整的<code>SlidingMenu</code>的代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlidingMenu</span> <span class="keyword">extends</span> <span class="title">HorizontalScrollView</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> LinearLayout mWapper;</div><div class="line">    <span class="keyword">private</span> ViewGroup mLeftMenuVg;</div><div class="line">    <span class="keyword">private</span> ViewGroup mMainContentVg;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mOnce = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mScreenWidth;</div><div class="line">    <span class="comment">// dp</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLeftMenuPaddingRight = <span class="number">50</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLeftMenuWidth;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsLeftMenuShown = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlidingMenu</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line"></div><div class="line">        WindowManager wm = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);</div><div class="line">        DisplayMetrics outMetrics = <span class="keyword">new</span> DisplayMetrics();</div><div class="line">        wm.getDefaultDisplay().getMetrics(outMetrics);</div><div class="line">        mScreenWidth = outMetrics.widthPixels;</div><div class="line"></div><div class="line">        mLeftMenuPaddingRight = (<span class="keyword">int</span>) TypedValue.applyDimension(</div><div class="line">                TypedValue.COMPLEX_UNIT_DIP,</div><div class="line">                mLeftMenuPaddingRight,</div><div class="line">                context.getResources().getDisplayMetrics());</div><div class="line"></div><div class="line">        TypedArray typedArray = context.getTheme().obtainStyledAttributes(attrs, R.styleable.SlidingMenu, defStyleAttr, <span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, n = typedArray.getIndexCount(); i &lt; n; i++) &#123;</div><div class="line">            <span class="keyword">int</span> attr = typedArray.getIndex(i);</div><div class="line">            <span class="keyword">switch</span> (attr) &#123;</div><div class="line">                <span class="keyword">case</span> R.styleable.SlidingMenu_rightPadding:</div><div class="line">                    mLeftMenuPaddingRight = typedArray.getDimensionPixelSize(attr, (<span class="keyword">int</span>)TypedValue.applyDimension(</div><div class="line">                            TypedValue.COMPLEX_UNIT_DIP,</div><div class="line">                            mLeftMenuPaddingRight,</div><div class="line">                            context.getResources().getDisplayMetrics()));</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        typedArray.recycle();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlidingMenu</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlidingMenu</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(!mOnce) &#123;</div><div class="line">            mWapper = (LinearLayout) getChildAt(<span class="number">0</span>);</div><div class="line">            mLeftMenuVg = (ViewGroup) mWapper.getChildAt(<span class="number">0</span>);</div><div class="line">            mMainContentVg = (ViewGroup) mWapper.getChildAt(<span class="number">1</span>);</div><div class="line">            mLeftMenuWidth = mLeftMenuVg.getLayoutParams().width = mScreenWidth - mLeftMenuPaddingRight;</div><div class="line">            mMainContentVg.getLayoutParams().width = mScreenWidth;</div><div class="line">            mOnce = !mOnce;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onLayout(changed, l, t, r, b);</div><div class="line">        <span class="keyword">if</span>(changed) &#123;</div><div class="line">            scrollTo(mLeftMenuWidth, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> action = ev.getAction();</div><div class="line">        <span class="keyword">switch</span> (action) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="keyword">int</span> scrollX = getScrollX();</div><div class="line">                <span class="keyword">if</span>(scrollX &gt;= mLeftMenuWidth / <span class="number">2</span>) &#123;</div><div class="line">                    smoothScrollTo(mLeftMenuWidth, <span class="number">0</span>);</div><div class="line">                    mIsLeftMenuShown = <span class="keyword">false</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    smoothScrollTo(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                    mIsLeftMenuShown = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showLeftMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(!isLeftMenuShown()) &#123;</div><div class="line">            smoothScrollTo(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">            mIsLeftMenuShown = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hideLeftMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(isLeftMenuShown()) &#123;</div><div class="line">            smoothScrollTo(mLeftMenuWidth, <span class="number">0</span>);</div><div class="line">            mIsLeftMenuShown = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeftMenuShown</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mIsLeftMenuShown;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onScrollChanged</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> oldl, <span class="keyword">int</span> oldt)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onScrollChanged(l, t, oldl, oldt);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">float</span> scale = l * <span class="number">1.0f</span> / mLeftMenuWidth;<span class="comment">//1.0~0 注意1.0f的乘法，使之成为float类型</span></div><div class="line">        <span class="keyword">float</span> contentScale = <span class="number">0.8f</span> + <span class="number">0.2f</span> * scale;</div><div class="line">        ViewHelper.setPivotX(mMainContentVg, <span class="number">0</span>);</div><div class="line">        ViewHelper.setPivotY(mMainContentVg, mMainContentVg.getHeight() / <span class="number">2</span>);</div><div class="line">        ViewHelper.setScaleX(mMainContentVg, contentScale);</div><div class="line">        ViewHelper.setScaleY(mMainContentVg, contentScale);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> menuTranslationShow = <span class="number">0.7f</span>;</div><div class="line">        ViewHelper.setTranslationX(mLeftMenuVg, l * menuTranslationShow);</div><div class="line">        <span class="keyword">float</span> menuScale = <span class="number">1.0f</span> - <span class="number">0.2f</span> * scale;</div><div class="line">        ViewHelper.setScaleX(mLeftMenuVg, menuScale);</div><div class="line">        ViewHelper.setScaleY(mLeftMenuVg, menuScale);</div><div class="line">        <span class="keyword">float</span> menuAlphaScale = <span class="number">1.0f</span> - <span class="number">0.5f</span> * scale;</div><div class="line">        ViewHelper.setAlpha(mLeftMenuVg, menuAlphaScale);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>基本上只要按照以上几步实现，理清其中的逻辑关系，这种模板式的自定义View还是比较简单的。</strong></p>
<p>代码地址：<a href="https://github.com/xing634325131/QQWapper" target="_blank" rel="external">https://github.com/xing634325131/QQWapper</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/07/31/Ubuntu dynamic screenshots, making GIF animation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/07/31/Ubuntu dynamic screenshots, making GIF animation/" itemprop="url">ubuntu动态截图，制作GIF动画</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-07-31T17:52:13+08:00">
                2015-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ubuntu/" itemprop="url" rel="index">
                    <span itemprop="name">Ubuntu</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/07/31/Ubuntu dynamic screenshots, making GIF animation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/07/31/Ubuntu dynamic screenshots, making GIF animation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/07/31/Ubuntu dynamic screenshots, making GIF animation/" class="leancloud_visitors" data-flag-title="ubuntu动态截图，制作GIF动画">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-安装-gtk-recordmydesktop-来录制屏幕-安装-mplayer-將视频分解成单帧图片-安装-imagemagick-將单帧图片压缩成一张-gif"><a href="#1-安装-gtk-recordmydesktop-来录制屏幕-安装-mplayer-將视频分解成单帧图片-安装-imagemagick-將单帧图片压缩成一张-gif" class="headerlink" title="1. 安装 gtk-recordmydesktop 来录制屏幕, 安装 mplayer 將视频分解成单帧图片, 安装 imagemagick 將单帧图片压缩成一张 gif:"></a>1. 安装 <code>gtk-recordmydesktop</code> 来录制屏幕, 安装 <code>mplayer</code> 將视频分解成单帧图片, 安装 <code>imagemagick</code> 將单帧图片压缩成一张 gif:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install imagemagick mplayer gtk-recordmydesktop</div></pre></td></tr></table></figure>
<h3 id="2-命令行下执行-录制并保存文件为-out-ogv"><a href="#2-命令行下执行-录制并保存文件为-out-ogv" class="headerlink" title="2. 命令行下执行, 录制并保存文件为 out.ogv:"></a>2. 命令行下执行, 录制并保存文件为 <code>out.ogv</code>:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gtk-recordmydesktop</div></pre></td></tr></table></figure>
<h3 id="3-执行如下命令將-out-ogv-分解成单帧图片"><a href="#3-执行如下命令將-out-ogv-分解成单帧图片" class="headerlink" title="3. 执行如下命令將 out.ogv 分解成单帧图片:"></a>3. 执行如下命令將 <code>out.ogv</code> 分解成单帧图片:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mplayer -ao null out.ogv -vo jpeg:outdir=.</div></pre></td></tr></table></figure>
<h3 id="4-执行如下命令將单帧图片压缩成-gif-图片"><a href="#4-执行如下命令將单帧图片压缩成-gif-图片" class="headerlink" title="4. 执行如下命令將单帧图片压缩成 gif 图片:"></a>4. 执行如下命令將单帧图片压缩成 gif 图片:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">convert *.jpg out.gif</div></pre></td></tr></table></figure>
<h3 id="5-执行如下命令將-gif-图片进行压缩"><a href="#5-执行如下命令將-gif-图片进行压缩" class="headerlink" title="5. 执行如下命令將 gif 图片进行压缩:"></a>5. 执行如下命令將 gif 图片进行压缩:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">convert out.gif -fuzz 10% -layers Optimize optimized.gif</div></pre></td></tr></table></figure>
<h3 id="6-最后一步-删除切分出来的jpg图片"><a href="#6-最后一步-删除切分出来的jpg图片" class="headerlink" title="6.最后一步,删除切分出来的jpg图片"></a>6.最后一步,删除切分出来的jpg图片</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm *.jpg</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/07/31/Resolve the problem of StateButton adaptation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/07/31/Resolve the problem of StateButton adaptation/" itemprop="url">解决StateButton适配的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-07-31T17:27:15+08:00">
                2015-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/07/31/Resolve the problem of StateButton adaptation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/07/31/Resolve the problem of StateButton adaptation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/07/31/Resolve the problem of StateButton adaptation/" class="leancloud_visitors" data-flag-title="解决StateButton适配的问题">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>定制一个以图片为背景的按钮,并且在按下时设置其透明度为原来的35%,之前我们是这么实现的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.kingtime.xingpeng.widget;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.BitmapDrawable;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.StateListDrawable;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by xingpeng on 15-7-31.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateButton</span> <span class="keyword">extends</span> <span class="title">Button</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> mHasSetBackground = <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">private</span> Drawable mBackground = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StateButton</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(context);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StateButton</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(context, attrs);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StateButton</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span>(!mHasSetBackground) &#123;</div><div class="line">			resetBackground();</div><div class="line">			mHasSetBackground = <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//设置按住时透明度背景为35%</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resetBackground</span><span class="params">()</span> </span>&#123;</div><div class="line">		Drawable normalDrawable = <span class="keyword">this</span>.getBackground();</div><div class="line">		<span class="keyword">int</span> width = <span class="keyword">this</span>.getWidth();</div><div class="line">		<span class="keyword">int</span> height = <span class="keyword">this</span>.getHeight();</div><div class="line"></div><div class="line">		Bitmap pressBitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</div><div class="line">		Canvas canvas = <span class="keyword">new</span> Canvas();</div><div class="line">		canvas.setBitmap(pressBitmap);</div><div class="line">		BitmapDrawable pressDrawable = <span class="keyword">new</span> BitmapDrawable(<span class="keyword">null</span>, pressBitmap);</div><div class="line">		normalDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, width , height);</div><div class="line">		normalDrawable.setAlpha(<span class="number">81</span>);</div><div class="line">		normalDrawable.draw(canvas);</div><div class="line"></div><div class="line">		StateListDrawable stateListDrawable = <span class="keyword">new</span> StateListDrawable();</div><div class="line">		stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.state_pressed&#125;, pressDrawable);</div><div class="line">		stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.state_focused&#125;, pressDrawable);</div><div class="line">		stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;&#125;, normalDrawable);</div><div class="line"></div><div class="line">		mBackground = stateListDrawable;</div><div class="line">		mBackground.setCallback(<span class="keyword">this</span>);</div><div class="line">		<span class="keyword">this</span>.setBackgroundDrawable(mBackground);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以直接在布局文件里面用,并且设定一张背景图片</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">com.kingtime.xingpeng.widget.StateButton</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"150dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"150dp"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@drawable/icon_camera"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>界面预览:</p>
<p><img src="/blog-img/20150731-4.3-common-opt.gif" alt="StateButton"></p>
<p>很长的一段时间里,这个是没有出现问题的,但是最近在5.0的系统上发现并不能用,按钮一直是灰色的,如下:</p>
<p><img src="/blog-img/20150731-5.0-error-opt.gif" alt="StateButton"></p>
<p>查找了很久这个问题,发现是这一句出现了问题<code>normalDrawable.setAlpha(81)</code>,本来在这里已经改变了正常图片的透明度,而后面依然将其设为正常的图片背景<code>stateListDrawable.addState(new int[]{}, normalDrawable);</code>,在5.0以上跟以下的区别,可能是对象的引用出现了问题,我们有两种方法解决这个问题.</p>
<h3 id="第一种是在5-0以上的系统单独设置按下时背景的透明度"><a href="#第一种是在5-0以上的系统单独设置按下时背景的透明度" class="headerlink" title="第一种是在5.0以上的系统单独设置按下时背景的透明度"></a>第一种是在5.0以上的系统单独设置按下时背景的透明度</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//设置按住时透明度背景为35%</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resetBackground</span><span class="params">()</span> </span>&#123;</div><div class="line">	Drawable normalDrawable = <span class="keyword">this</span>.getBackground();</div><div class="line">	<span class="keyword">int</span> width = <span class="keyword">this</span>.getWidth();</div><div class="line">	<span class="keyword">int</span> height = <span class="keyword">this</span>.getHeight();</div><div class="line"></div><div class="line">	Bitmap pressBitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</div><div class="line">	Canvas canvas = <span class="keyword">new</span> Canvas();</div><div class="line">	canvas.setBitmap(pressBitmap);</div><div class="line">	BitmapDrawable pressDrawable = <span class="keyword">new</span> BitmapDrawable(<span class="keyword">null</span>, pressBitmap);</div><div class="line">	normalDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">	<span class="keyword">if</span>(Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">		pressDrawable.setAlpha(<span class="number">81</span>);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		normalDrawable.setAlpha(<span class="number">81</span>);</div><div class="line">	&#125;</div><div class="line">	normalDrawable.draw(canvas);</div><div class="line"></div><div class="line">	StateListDrawable stateListDrawable = <span class="keyword">new</span> StateListDrawable();</div><div class="line">	stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.state_pressed&#125;, pressDrawable);</div><div class="line">	stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.state_focused&#125;, pressDrawable);</div><div class="line">	stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;&#125;, normalDrawable);</div><div class="line"></div><div class="line">	mBackground = stateListDrawable;</div><div class="line">	mBackground.setCallback(<span class="keyword">this</span>);</div><div class="line">	<span class="keyword">this</span>.setBackgroundDrawable(mBackground);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种可以解决问题,但是在5.0以下的系统也用这种方法会出现按钮按下时变为空白的情况.</p>
<h3 id="第二种是单独生成一个Drawable-避免用其引用"><a href="#第二种是单独生成一个Drawable-避免用其引用" class="headerlink" title="第二种是单独生成一个Drawable,避免用其引用"></a>第二种是单独生成一个Drawable,避免用其引用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.kingtime.xingpeng.widget;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.BitmapDrawable;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.StateListDrawable;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.kingtime.xingpeng.applicationdemo.R;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by gugutian on 15-7-31.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateButton</span> <span class="keyword">extends</span> <span class="title">Button</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> mHasSetBackground = <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">private</span> Drawable mBackground = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StateButton</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(context);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StateButton</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(context, attrs);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StateButton</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span>(!mHasSetBackground) &#123;</div><div class="line">			resetBackground();</div><div class="line">			mHasSetBackground = <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//设置按住时透明度背景为35%</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resetBackground</span><span class="params">()</span> </span>&#123;</div><div class="line">		Drawable normalDrawable = generateNewDrawable(<span class="keyword">this</span>.getBackground());</div><div class="line">		<span class="keyword">int</span> width = <span class="keyword">this</span>.getWidth();</div><div class="line">		<span class="keyword">int</span> height = <span class="keyword">this</span>.getHeight();</div><div class="line"></div><div class="line">		Bitmap pressBitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</div><div class="line">		Canvas canvas = <span class="keyword">new</span> Canvas();</div><div class="line">		canvas.setBitmap(pressBitmap);</div><div class="line">		BitmapDrawable pressDrawable = <span class="keyword">new</span> BitmapDrawable(<span class="keyword">null</span>, pressBitmap);</div><div class="line">		normalDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, width , height);</div><div class="line">		normalDrawable.setAlpha(<span class="number">81</span>);</div><div class="line">		normalDrawable.draw(canvas);</div><div class="line"></div><div class="line">		StateListDrawable stateListDrawable = <span class="keyword">new</span> StateListDrawable();</div><div class="line">		stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.state_pressed&#125;, pressDrawable);</div><div class="line">		stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.state_focused&#125;, pressDrawable);</div><div class="line">		stateListDrawable.addState(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;&#125;, <span class="keyword">this</span>.getBackground());</div><div class="line"></div><div class="line">		mBackground = stateListDrawable;</div><div class="line">		mBackground.setCallback(<span class="keyword">this</span>);</div><div class="line">		<span class="keyword">this</span>.setBackgroundDrawable(mBackground);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> Drawable <span class="title">generateNewDrawable</span><span class="params">(Drawable oldDrawable)</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> width = <span class="keyword">this</span>.getWidth();</div><div class="line">		<span class="keyword">int</span> height = <span class="keyword">this</span>.getHeight();</div><div class="line"></div><div class="line">		Bitmap bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</div><div class="line">		Canvas canvas = <span class="keyword">new</span> Canvas();</div><div class="line">		canvas.setBitmap(bitmap);</div><div class="line">		BitmapDrawable drawable = <span class="keyword">new</span> BitmapDrawable(<span class="keyword">null</span>, bitmap);</div><div class="line">		oldDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">		oldDrawable.draw(canvas);</div><div class="line"></div><div class="line">		<span class="keyword">return</span> drawable;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样又能愉快的工作了.</p>
<p><img src="/blog-img/20150731-5.0-common-opt.gif" alt="StateButton"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/07/31/Solve Uri correct access to the image path/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/07/31/Solve Uri correct access to the image path/" itemprop="url">解决4.4以上系统无法根据Uri正确获取图片路径的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-07-31T11:05:44+08:00">
                2015-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/07/31/Solve Uri correct access to the image path/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/07/31/Solve Uri correct access to the image path/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/07/31/Solve Uri correct access to the image path/" class="leancloud_visitors" data-flag-title="解决4.4以上系统无法根据Uri正确获取图片路径的问题">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当需要获取一张手机里的图片时,我们会调起图片浏览器选择图片,图片浏览器会返回图片的<code>Uri</code>,然后根据<code>Uri</code>就可以得到图片的路径,这段代码在4.4一下的系统是没有问题的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 得到当前选中的图片的地址</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getFilePathFromContentUri</span><span class="params">(Uri selectedPicUri)</span> </span>&#123;</div><div class="line">	String filePath = <span class="string">""</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="keyword">if</span> (<span class="string">"file"</span>.equalsIgnoreCase(selectedPicUri.getScheme())) &#123;</div><div class="line">			filePath = selectedPicUri.getPath();</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			String[] filePathColumn = &#123;MediaColumns.DATA&#125;;</div><div class="line">			Cursor c = <span class="keyword">null</span>;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				c = getContentResolver().query(selectedPicUri, filePathColumn, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">				<span class="keyword">if</span> (c.moveToFirst()) &#123;</div><div class="line">					filePath = c.getString(c.getColumnIndex(filePathColumn[<span class="number">0</span>]));</div><div class="line">				&#125;</div><div class="line">			&#125; <span class="keyword">finally</span> &#123;</div><div class="line">				<span class="keyword">if</span> (c != <span class="keyword">null</span> &amp;&amp; !c.isClosed()) &#123;</div><div class="line">					c.close();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">		filePath = <span class="string">""</span>;</div><div class="line">		DebugUtil.exception(TAG, e);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> filePath;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然而在4.4的系统上,得到的路径是空的,是因为这句<code>getContentResolver().query(selectedPicUri, filePathColumn, null, null, null);</code>,由于Uri的格式在4.4以上的系统发生了改变,所有需要特殊处理一下,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPhotoPathFromContentUri</span><span class="params">(Context context, Uri uri)</span> </span>&#123;</div><div class="line">	String photoPath = <span class="string">""</span>;</div><div class="line">	<span class="keyword">if</span>(context == <span class="keyword">null</span> || uri == <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">return</span> photoPath;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT &amp;&amp; DocumentsContract.isDocumentUri(context, uri)) &#123;</div><div class="line">		String docId = DocumentsContract.getDocumentId(uri);</div><div class="line">		<span class="keyword">if</span>(isExternalStorageDocument(uri)) &#123;</div><div class="line">			String [] split = docId.split(<span class="string">":"</span>);</div><div class="line">			<span class="keyword">if</span>(split.length &gt;= <span class="number">2</span>) &#123;</div><div class="line">				String type = split[<span class="number">0</span>];</div><div class="line">				<span class="keyword">if</span>(<span class="string">"primary"</span>.equalsIgnoreCase(type)) &#123;</div><div class="line">					photoPath = SdHelper.SD_DIR + File.separator + split[<span class="number">1</span>];</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(isDownloadsDocument(uri)) &#123;</div><div class="line">			Uri contentUri = ContentUris.withAppendedId(Uri.parse(<span class="string">"content://downloads/public_downloads"</span>), Long.valueOf(docId));</div><div class="line">			photoPath = getDataColumn(context, contentUri, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(isMediaDocument(uri)) &#123;</div><div class="line">			String[] split = docId.split(<span class="string">":"</span>);</div><div class="line">			<span class="keyword">if</span>(split.length &gt;= <span class="number">2</span>) &#123;</div><div class="line">				String type = split[<span class="number">0</span>];</div><div class="line">				Uri contentUris = <span class="keyword">null</span>;</div><div class="line">				<span class="keyword">if</span>(<span class="string">"image"</span>.equals(type)) &#123;</div><div class="line">					contentUris = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"video"</span>.equals(type)) &#123;</div><div class="line">					contentUris = MediaStore.Video.Media.EXTERNAL_CONTENT_URI;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"audio"</span>.equals(type)) &#123;</div><div class="line">					contentUris = MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;</div><div class="line">				&#125;</div><div class="line">				String selection = MediaStore.Images.Media._ID + <span class="string">"=?"</span>;</div><div class="line">				String[] selectionArgs = <span class="keyword">new</span> String[] &#123; split[<span class="number">1</span>] &#125;;</div><div class="line">				photoPath = getDataColumn(context, contentUris, selection, selectionArgs);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"file"</span>.equalsIgnoreCase(uri.getScheme())) &#123;</div><div class="line">		photoPath = uri.getPath();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		photoPath = getDataColumn(context, uri, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> photoPath;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isExternalStorageDocument</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">"com.android.externalstorage.documents"</span>.equals(uri.getAuthority());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isDownloadsDocument</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">"com.android.providers.downloads.documents"</span>.equals(uri.getAuthority());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMediaDocument</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">"com.android.providers.media.documents"</span>.equals(uri.getAuthority());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getDataColumn</span><span class="params">(Context context, Uri uri, String selection, String[] selectionArgs)</span> </span>&#123;</div><div class="line">	Cursor cursor = <span class="keyword">null</span>;</div><div class="line">	String column = MediaStore.Images.Media.DATA;</div><div class="line">	String[] projection = &#123; column &#125;;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		cursor = context.getContentResolver().query(uri, projection, selection, selectionArgs, <span class="keyword">null</span>);</div><div class="line">		<span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.moveToFirst()) &#123;</div><div class="line">			<span class="keyword">int</span> index = cursor.getColumnIndexOrThrow(column);</div><div class="line">			<span class="keyword">return</span> cursor.getString(index);</div><div class="line">		&#125;</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">		<span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; !cursor.isClosed())</div><div class="line">				cursor.close();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就没有问题了.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/07/31/Summary of Android Problem and Experiences/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/07/31/Summary of Android Problem and Experiences/" itemprop="url">Android常见问题及开发经验总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-07-31T10:23:16+08:00">
                2015-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/07/31/Summary of Android Problem and Experiences/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/07/31/Summary of Android Problem and Experiences/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/07/31/Summary of Android Problem and Experiences/" class="leancloud_visitors" data-flag-title="Android常见问题及开发经验总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文地址:<a href="http://blog.csdn.net/shaoyezhangliwei/article/details/46683705" target="_blank" rel="external">http://blog.csdn.net/shaoyezhangliwei/article/details/46683705</a></p>
<h3 id="1-如何更好的优化一个ListView-使其变得非常流畅？"><a href="#1-如何更好的优化一个ListView-使其变得非常流畅？" class="headerlink" title="1.如何更好的优化一个ListView,使其变得非常流畅？"></a>1.如何更好的优化一个<code>ListView</code>,使其变得非常流畅？</h3><blockquote>
<ul>
<li>Item布局，层级越少越好，使用<code>hierarchyview</code>工具查看优化。 </li>
<li>复用<code>convertView</code></li>
<li>使用<code>ViewHolder</code></li>
<li>item中有图片时，异步加载 </li>
<li>快速滑动时，不加载图片 </li>
<li>item中有图片时，应对图片进行适当压缩 </li>
<li>实现数据的分页加载</li>
</ul>
</blockquote>
<h3 id="2-对于Android-的安全问题，一般都有哪些？"><a href="#2-对于Android-的安全问题，一般都有哪些？" class="headerlink" title="2.对于Android 的安全问题，一般都有哪些？"></a>2.对于Android 的安全问题，一般都有哪些？</h3><blockquote>
<ul>
<li>错误导出组件 </li>
<li>参数校验不严 </li>
<li><code>WebView</code>引入各种安全问题,<code>webview</code>中的<strong>js(要注意代码混淆引起的问题)</strong>注入 </li>
<li>不混淆、不防二次打包 </li>
<li>明文存储关键信息 </li>
<li>错误使用<strong>HTTPS</strong></li>
<li>山寨加密方法 </li>
<li>滥用权限、内存泄露、使用debug签名</li>
</ul>
</blockquote>
<h3 id="3-如何缩减APK包大小？"><a href="#3-如何缩减APK包大小？" class="headerlink" title="3. 如何缩减APK包大小？"></a>3. 如何缩减APK包大小？</h3><p><strong>代码</strong> </p>
<blockquote>
<ul>
<li>保持良好的编程习惯，不要重复或者不用的代码，谨慎添加libs，移除使用不到的libs。 </li>
<li>使用<code>proguard</code>混淆代码，它会对不用的代码做优化，并且混淆后也能够减少安装包的大小。 </li>
<li><code>native code</code>的部分，大多数情况下只需要支持armabi与x86的架构即可。如果非必须，可以考虑拿掉x86的部分。</li>
</ul>
</blockquote>
<p><strong>资源</strong> </p>
<blockquote>
<ul>
<li>使用<code>Lint</code>工具查找没有使用到的资源。去除不使用的图片，String，XML等等。 <code>assets</code>目录下的资源请确保没有用不上的文件。 </li>
<li>生成APK的时候，<code>aapt</code>工具本身会对png做优化，但是在此之前还可以使用其他工具如<code>tinypng</code>对图片进行进一步的压缩预处理。 </li>
<li>jpeg还是png，根据需要做选择，在某些时候jpeg可以减少图片的体积。 对于<code>9.png</code>的图片，可拉伸区域尽量切小，另外可以通过使用<code>9.png</code>拉伸达到大图效果的时候尽量不要使用整张大图。 </li>
</ul>
</blockquote>
<p><strong>策略</strong> </p>
<blockquote>
<ul>
<li>有选择性的提供<code>hdpi</code>，<code>xhdpi</code>，<code>xxhdpi</code>的图片资源。建议优先提供<code>xhdpi</code>的图片，对于<code>mdpi</code>，<code>ldpi</code>与<code>xxxhdpi</code>根据需要提供有差异的部分即可。 </li>
<li>尽可能的重用已有的图片资源。例如对称的图片，只需要提供一张，另外一张图片可以通过代码旋转的方式实现。 </li>
<li>能用代码绘制实现的功能，尽量不要使用大量的图片。例如减少使用多张图片组成<code>animate-list</code>的<code>AnimationDrawable</code>，这种方式提供了多张图片很占空间。</li>
</ul>
</blockquote>
<h3 id="4-Android与服务器交互的方式中的对称加密和非对称加密是怎么回事"><a href="#4-Android与服务器交互的方式中的对称加密和非对称加密是怎么回事" class="headerlink" title="4.Android与服务器交互的方式中的对称加密和非对称加密是怎么回事?"></a>4.Android与服务器交互的方式中的对称加密和非对称加密是怎么回事?</h3><blockquote>
<ul>
<li>对称加密，就是加密和解密数据都是使用同一个key，这方面的算法有<code>DES</code>。 </li>
<li>非对称加密，加密和解密是使用不同的key。发送数据之前要先和服务端约定生成公钥和私钥，使用公钥加密的数据可以用私钥解密，反之。这方面的算法有<code>RSA</code>。<code>ssh</code> 和 <code>ssl</code>都是典型的非对称加密。</li>
</ul>
</blockquote>
<h3 id="5-设备横竖屏切换的时候，activity中生命周期的问题？"><a href="#5-设备横竖屏切换的时候，activity中生命周期的问题？" class="headerlink" title="5.设备横竖屏切换的时候，activity中生命周期的问题？"></a>5.设备横竖屏切换的时候，activity中生命周期的问题？</h3><blockquote>
<ul>
<li>不设置Activity的<code>android:configChanges</code>时，切屏会重新调用各个生命周期，切横屏时会执行一次，切竖屏时会执行两次 </li>
<li>设置Activity的<code>android:configChanges=”orientation”</code>时，切屏还是会重新调用各个生命周期，切横、竖屏时只会执行一次 </li>
<li>设置Activity的<code>android:configChanges=”orientation|keyboardHidden”</code>时，切屏不会重新调用各个生命周期，只会执行<code>onConfigurationChanged</code>方法</li>
</ul>
</blockquote>
<h3 id="6-Android启动Service的两种方式是什么-适用情况一般是哪些？"><a href="#6-Android启动Service的两种方式是什么-适用情况一般是哪些？" class="headerlink" title="6.Android启动Service的两种方式是什么?适用情况一般是哪些？"></a>6.Android启动Service的两种方式是什么?适用情况一般是哪些？</h3><blockquote>
<ul>
<li>如果后台服务开始后基本可以独立运行的话，可以用<code>startService</code>。音乐播放器就可以这样用。它们会一直运行直到你调用 <code>stopSelf</code>或者<code>stopService</code>。你可以通过发送Intent或者接收Intent来与正在运行的后台服务通信，但大部分时间，你只是启动服务并让它独立运行。如果你需要与后台服务通过一个持续的连接来比较频繁地通信，建议使用bind()。比如你需要定位服务不停地把更新后的地理位置传给UI。Binder比Intent开发起来复杂一些，但如果真的需要，你也只能使用它。 </li>
<li><code>startService</code>：生命周期与调用者不同。启动后若调用者未调用<code>stopService</code>而直接退出，<code>Service</code>仍会运行 </li>
<li><code>bindService</code>：生命周期与调用者绑定，调用者一旦退出，<code>Service</code>就会调用<code>unBind-&gt;onDestroy</code></li>
</ul>
</blockquote>
<h3 id="7-Android中Context一般怎么用"><a href="#7-Android中Context一般怎么用" class="headerlink" title="7.Android中Context一般怎么用?"></a>7.Android中Context一般怎么用?</h3><blockquote>
<ul>
<li>Context:包含上下文信息(外部值) 的一个参数. Android 中的 Context 分三种,<code>Application Context</code>,<code>Activity Context</code> ,<code>Service Context</code>. </li>
<li>它描述的是一个应用程序环境的信息，通过它我们可以获取应用程序的资源和类，也包括一些应用级别操作，例如：启动一个Activity，发送广播，接受Intent信息等</li>
</ul>
</blockquote>
<h3 id="8-Service的onCreate回调在UI线程中吗？"><a href="#8-Service的onCreate回调在UI线程中吗？" class="headerlink" title="8.Service的onCreate回调在UI线程中吗？"></a>8.Service的onCreate回调在UI线程中吗？</h3><blockquote>
<ul>
<li>Service生命周期的各个回调和其他的应用组件一样，是跑在主线程中，会影响到你的UI操作或者阻塞主线程中的其他事情</li>
</ul>
</blockquote>
<h3 id="9-AsyncTask的内部实现，适用的场景是？"><a href="#9-AsyncTask的内部实现，适用的场景是？" class="headerlink" title="9.AsyncTask的内部实现，适用的场景是？"></a>9.AsyncTask的内部实现，适用的场景是？</h3><blockquote>
<ul>
<li>AsyncTask内部也是Handler机制来完成的，只不过Android提供了执行框架来提供线程池来执行相应地任务，因为线程池的大小问题，所以AsyncTask只应该用来执行耗时时间较短的任务，比如HTTP请求，大规模的下载和数据库的更改不适用于AsyncTask，因为会导致线程池堵塞，没有线程来执行其他的任务，导致的情形是会发生AsyncTask根本执行不了的问题。</li>
</ul>
</blockquote>
<h3 id="10-binder机制的理解"><a href="#10-binder机制的理解" class="headerlink" title="10.binder机制的理解?"></a>10.binder机制的理解?</h3><blockquote>
<ul>
<li>binder是一种<code>IPC</code>机制,进程间通讯的一种工具. </li>
<li>Java层可以利用<code>aidl</code>工具来实现相应的接口.</li>
</ul>
</blockquote>
<h3 id="11-Android中进程间通信有哪些实现方式？"><a href="#11-Android中进程间通信有哪些实现方式？" class="headerlink" title="11.Android中进程间通信有哪些实现方式？"></a>11.Android中进程间通信有哪些实现方式？</h3><blockquote>
<ul>
<li><code>Intent</code>，<code>Binder（AIDL）</code>，<code>Messenger</code>，<code>BroadcastReceiver</code></li>
</ul>
</blockquote>
<h3 id="12-介绍下实现一个自定义view的基本流程"><a href="#12-介绍下实现一个自定义view的基本流程" class="headerlink" title="12.介绍下实现一个自定义view的基本流程"></a>12.介绍下实现一个自定义view的基本流程</h3><blockquote>
<ul>
<li>自定义View的属性 编写<code>attr.xml</code>文件 </li>
<li>在layout布局文件中引用，同时引用命名空间 </li>
<li>在View的构造方法中获得我们自定义的属性 ，在自定义控件中进行读取（构造方法拿到<code>attr.xml</code>文件值） </li>
<li>重写<code>onMesure</code></li>
<li>重写<code>onDraw</code></li>
</ul>
</blockquote>
<h3 id="13-Android中touch事件的传递机制是怎样的"><a href="#13-Android中touch事件的传递机制是怎样的" class="headerlink" title="13.Android中touch事件的传递机制是怎样的?"></a>13.Android中touch事件的传递机制是怎样的?</h3><blockquote>
<ul>
<li>Touch事件传递的相关API有<code>dispatchTouchEvent</code>、<code>onTouchEvent</code>、<code>onInterceptTouchEvent</code></li>
<li>Touch事件相关的类有<code>View</code>、<code>ViewGroup</code>、<code>Activity</code> </li>
<li>Touch事件会被封装成<code>MotionEvent</code>对象，该对象封装了手势按下、移动、松开等动作 </li>
<li>Touch事件通常从<code>Activity#dispatchTouchEvent</code>发出，只要没有被消费，会一直往下传递，到最底层的View。 </li>
<li>如果Touch事件传递到的每个View都不消费事件，那么Touch事件会反向向上传递,最终交由<code>Activity#onTouchEvent</code>处理. </li>
<li><code>onInterceptTouchEvent</code>为ViewGroup特有，可以拦截事件. </li>
<li>Down事件到来时，如果一个View没有消费该事件，那么后续的<code>MOVE/UP</code>事件都不会再给它</li>
</ul>
</blockquote>
<h3 id="14-Android多线程的实现方式有哪些"><a href="#14-Android多线程的实现方式有哪些" class="headerlink" title="14.Android多线程的实现方式有哪些?"></a>14.Android多线程的实现方式有哪些?</h3><blockquote>
<ul>
<li>Thread &amp; AsyncTask </li>
<li>Thread 可以与Loop 和 Handler 共用建立消息处理队列 </li>
<li>AsyncTask 可以作为线程池并行处理多任务</li>
</ul>
</blockquote>
<h3 id="15-Android开发中何时使用多进程？使用多进程的好处是什么？"><a href="#15-Android开发中何时使用多进程？使用多进程的好处是什么？" class="headerlink" title="15.Android开发中何时使用多进程？使用多进程的好处是什么？"></a>15.Android开发中何时使用多进程？使用多进程的好处是什么？</h3><blockquote>
<ul>
<li>要想知道如何使用多进程，先要知道Android里的多进程概念。一般情况下，一个应用程序就是一个进程，这个进程名称就是应用程序包名。我们知道进程是系统分配资源和调度的基本单位，所以每个进程都有自己独立的资源和内存空间，别的进程是不能任意访问其他进程的内存和资源的。 </li>
<li>那如何让自己的应用拥有多个进程？ </li>
<li>很简单，我们的四大组件在<code>AndroidManifest</code>文件中注册的时候，有个属性是<code>android:process</code>，<br>1.这里可以指定组件的所处的进程。默认就是应用的主进程。指定为别的进程之后，系统在启动这个组件的时候，就先创建（如果还没创建的话）这个进程，然后再创建该组件。你可以重载<code>Application</code>类的<code>onCreate</code>方法，打印出它的进程名称，就可以清楚的看见了。再设置<code>android:process</code>属性时候，有个地方需要注意：如果是<code>android:process=”:deamon”</code>，以:开头的名字，则表示这是一个应用程序的私有进程，否则它是一个全局进程。私有进程的进程名称是会在冒号前自动加上包名，而全局进程则不会。一般我们都是有私有进程，很少使用全局进程。他们的具体区别不知道有没有谁能补充一下。<br>2.使用多进程显而易见的好处就是分担主进程的内存压力。我们的应用越做越大，内存越来越多，将一些独立的组件放到不同的进程，它就不占用主进程的内存空间了。当然还有其他好处，有心人会发现Android后台进程里有很多应用是多个进程的，因为它们要常驻后台，特别是即时通讯或者社交应用，不过现在多进程已经被用烂了。典型用法是在启动一个不可见的轻量级私有进程，在后台收发消息，或者做一些耗时的事情，或者开机启动这个进程，然后做监听等。还有就是防止主进程被杀守护进程，守护进程和主进程之间相互监视，有一方被杀就重新启动它。应该还有还有其他好处，这里就不多说了。<br>3.坏处的话，多占用了系统的空间，大家都这么用的话系统内存很容易占满而导致卡顿。消耗用户的电量。应用程序架构会变复杂，应为要处理多进程之间的通信。这里又是另外一个问题了。</li>
</ul>
</blockquote>
<h3 id="16-ANR是什么？怎样避免和解决ANR"><a href="#16-ANR是什么？怎样避免和解决ANR" class="headerlink" title="16.ANR是什么？怎样避免和解决ANR?"></a>16.ANR是什么？怎样避免和解决ANR?</h3><blockquote>
<ul>
<li>ANR:<code>Application Not Responding</code>，即应用无响应 </li>
<li>ANR一般有三种类型：<br>1：<code>KeyDispatchTimeout</code>(5 seconds) –主要类型<br>按键或触摸事件在特定时间内无响应<br>2：<code>BroadcastTimeout</code>(10 seconds)<br>BroadcastReceiver在特定时间内无法处理完成<br>3：<code>ServiceTimeout</code>(20 seconds) –小概率类型<br>Service在特定的时间内无法处理完成<br>超时的原因一般有两种：<br>(1)当前的事件没有机会得到处理（UI线程正在处理前一个事件没有及时完成或者looper被某种原因阻塞住）<br>(2)当前的事件正在处理，但没有及时完成<br>UI线程尽量只做跟UI相关的工作，耗时的工作（数据库操作，I/O，连接网络或者其他可能阻碍UI线程的操作）放入单独的线程处理，尽量用Handler来处理UI thread和thread之间的交互。<br>UI线程主要包括如下：<br>Activity:<code>onCreate()</code>, <code>onResume()</code>, <code>onDestroy()</code>, <code>onKeyDown()</code>, <code>onClick()</code><br>AsyncTask: <code>onPreExecute()</code>, <code>onProgressUpdate()</code>, <code>onPostExecute()</code>, <code>onCancel()</code><br>Mainthread handler: <code>handleMessage()</code>, <code>post(runnable r)</code><br>other</li>
</ul>
</blockquote>
<h3 id="17-Android下解决滑动冲突的常见思路是什么"><a href="#17-Android下解决滑动冲突的常见思路是什么" class="headerlink" title="17.Android下解决滑动冲突的常见思路是什么?"></a>17.Android下解决滑动冲突的常见思路是什么?</h3><blockquote>
<ul>
<li>相关的滑动组件 重写<code>onInterceptTouchEvent</code>，然后判断根据xy值，来决定是否要拦截当前操作</li>
</ul>
</blockquote>
<h3 id="18-如何把一个应用设置为系统应用？"><a href="#18-如何把一个应用设置为系统应用？" class="headerlink" title="18.如何把一个应用设置为系统应用？"></a>18.如何把一个应用设置为系统应用？</h3><blockquote>
<ul>
<li>成为系统应用，首先要在 对应设备的 Android 源码 SDK 下编译，编译好之后： </li>
<li>此 Android 设备是 Debug 版本，并且已经 root，直接将此 apk 用 adb 工具 push 到 <code>system/app</code> 或 <code>system/priv-app</code> 下即可。 </li>
<li>如果非 root 设备，需要编译后重新烧写设备镜像即可。</li>
<li>有些权限(如 <code>WRITE_SECURE_SETTINGS</code> )，是不开放给第三方应用的，只能在对应设备源码中编译然后作为系统 app 使用。</li>
</ul>
</blockquote>
<h3 id="19、Android内存泄露研究"><a href="#19、Android内存泄露研究" class="headerlink" title="19、Android内存泄露研究"></a>19、Android内存泄露研究</h3><blockquote>
<ul>
<li>Android内存泄漏指的是进程中某些对象（垃圾对象）已经没有使用价值了，但是它们却可以直接或间接地引用到<code>gc roots</code>导致无法被GC回收。无用的对象占据着内存空间，使得实际可使用内存变小，形象地说法就是内存泄漏了。 </li>
<li>场景<br>类的静态变量持有大数据对象<br>静态变量长期维持到大数据对象的引用，阻止垃圾回收。<br>非静态内部类的静态实例<br>非静态内部类会维持一个到外部类实例的引用，如果非静态内部类的实例是静态的，就会间接长期维持着外部类的引用，阻止被回收掉。<br>资源对象未关闭<br>资源性对象如<code>Cursor</code>、<code>File</code>、<code>Socket</code>，应该在使用后及时关闭。未在finally中关闭，会导致异常情况下资源对象未被释放的隐患。<br>注册对象未反注册<br>未反注册会导致观察者列表里维持着对象的引用，阻止垃圾回收。<br>Handler临时性内存泄露<br>Handler通过发送Message与主线程交互，Message发出之后是存储在MessageQueue中的，有些Message也不是马上就被处理的。在Message中存在一个 target，是Handler的一个引用，如果Message在Queue中存在的时间越长，就会导致Handler无法被回收。如果Handler是非静态的，则会导致Activity或者Service不会被回收。<br>由于AsyncTask内部也是Handler机制，同样存在内存泄漏的风险。<br>此种内存泄露，一般是临时性的。</li>
</ul>
</blockquote>
<h3 id="20-内存泄露检测有什么好方法？"><a href="#20-内存泄露检测有什么好方法？" class="headerlink" title="20.内存泄露检测有什么好方法？"></a>20.内存泄露检测有什么好方法？</h3><blockquote>
<ul>
<li>检测：<br>1、<code>DDMS Heap</code>发现内存泄露<br><code>dataObject totalSize</code>的大小，是否稳定在一个范围内，如果操作程序，不断增加，说明内存泄露<br>2、使用<code>Heap Tool</code>进行内存快照前后对比<br>BlankActivity手动触发GC进行前后对比，对象是否被及时回收</li>
</ul>
</blockquote>
<h3 id="21-android-R-layout下面的布局都是什么意思？"><a href="#21-android-R-layout下面的布局都是什么意思？" class="headerlink" title="21.android.R.layout下面的布局都是什么意思？"></a>21.android.R.layout下面的布局都是什么意思？</h3><blockquote>
<ul>
<li>这是几个列表选项的布局文件。 在List声明实例化时需要传入的。<br><code>android.R.layout.simple_list_item_1</code>          列表选项的简单布局<br><code>android.R.layout.simple_expandable_list_item_2</code>  可展开列表选项的简单布局<br><code>android.R.layout.simple_list_item_checked</code>  列表被选中的选项的简单布局<br><code>android.R.layout.simple_list_item_multiple_choice</code>  可选列表的选项的简单布局 多选<br><code>android.R.layout.simple_list_item_single_choice</code>   可选列表的选项的简单布局 单选</li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.gugutian.com/2015/07/31/Summary of Android Problem And Experiences/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="古古天">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古古天">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/07/31/Summary of Android Problem And Experiences/" itemprop="url">Android常见问题及开发经验总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-07-31T10:23:16+08:00">
                2015-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/07/31/Summary of Android Problem And Experiences/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/07/31/Summary of Android Problem And Experiences/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/07/31/Summary of Android Problem And Experiences/" class="leancloud_visitors" data-flag-title="Android常见问题及开发经验总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文地址:<a href="http://blog.csdn.net/shaoyezhangliwei/article/details/46683705" target="_blank" rel="external">http://blog.csdn.net/shaoyezhangliwei/article/details/46683705</a></p>
<h3 id="1-如何更好的优化一个ListView-使其变得非常流畅？"><a href="#1-如何更好的优化一个ListView-使其变得非常流畅？" class="headerlink" title="1.如何更好的优化一个ListView,使其变得非常流畅？"></a>1.如何更好的优化一个<code>ListView</code>,使其变得非常流畅？</h3><blockquote>
<ul>
<li>Item布局，层级越少越好，使用<code>hierarchyview</code>工具查看优化。 </li>
<li>复用<code>convertView</code></li>
<li>使用<code>ViewHolder</code></li>
<li>item中有图片时，异步加载 </li>
<li>快速滑动时，不加载图片 </li>
<li>item中有图片时，应对图片进行适当压缩 </li>
<li>实现数据的分页加载</li>
</ul>
</blockquote>
<h3 id="2-对于Android-的安全问题，一般都有哪些？"><a href="#2-对于Android-的安全问题，一般都有哪些？" class="headerlink" title="2.对于Android 的安全问题，一般都有哪些？"></a>2.对于Android 的安全问题，一般都有哪些？</h3><blockquote>
<ul>
<li>错误导出组件 </li>
<li>参数校验不严 </li>
<li><code>WebView</code>引入各种安全问题,<code>webview</code>中的<strong>js(要注意代码混淆引起的问题)</strong>注入 </li>
<li>不混淆、不防二次打包 </li>
<li>明文存储关键信息 </li>
<li>错误使用<strong>HTTPS</strong></li>
<li>山寨加密方法 </li>
<li>滥用权限、内存泄露、使用debug签名</li>
</ul>
</blockquote>
<h3 id="3-如何缩减APK包大小？"><a href="#3-如何缩减APK包大小？" class="headerlink" title="3. 如何缩减APK包大小？"></a>3. 如何缩减APK包大小？</h3><p><strong>代码</strong> </p>
<blockquote>
<ul>
<li>保持良好的编程习惯，不要重复或者不用的代码，谨慎添加libs，移除使用不到的libs。 </li>
<li>使用<code>proguard</code>混淆代码，它会对不用的代码做优化，并且混淆后也能够减少安装包的大小。 </li>
<li><code>native code</code>的部分，大多数情况下只需要支持armabi与x86的架构即可。如果非必须，可以考虑拿掉x86的部分。</li>
</ul>
</blockquote>
<p><strong>资源</strong> </p>
<blockquote>
<ul>
<li>使用<code>Lint</code>工具查找没有使用到的资源。去除不使用的图片，String，XML等等。 <code>assets</code>目录下的资源请确保没有用不上的文件。 </li>
<li>生成APK的时候，<code>aapt</code>工具本身会对png做优化，但是在此之前还可以使用其他工具如<code>tinypng</code>对图片进行进一步的压缩预处理。 </li>
<li>jpeg还是png，根据需要做选择，在某些时候jpeg可以减少图片的体积。 对于<code>9.png</code>的图片，可拉伸区域尽量切小，另外可以通过使用<code>9.png</code>拉伸达到大图效果的时候尽量不要使用整张大图。 </li>
</ul>
</blockquote>
<p><strong>策略</strong> </p>
<blockquote>
<ul>
<li>有选择性的提供<code>hdpi</code>，<code>xhdpi</code>，<code>xxhdpi</code>的图片资源。建议优先提供<code>xhdpi</code>的图片，对于<code>mdpi</code>，<code>ldpi</code>与<code>xxxhdpi</code>根据需要提供有差异的部分即可。 </li>
<li>尽可能的重用已有的图片资源。例如对称的图片，只需要提供一张，另外一张图片可以通过代码旋转的方式实现。 </li>
<li>能用代码绘制实现的功能，尽量不要使用大量的图片。例如减少使用多张图片组成<code>animate-list</code>的<code>AnimationDrawable</code>，这种方式提供了多张图片很占空间。</li>
</ul>
</blockquote>
<h3 id="4-Android与服务器交互的方式中的对称加密和非对称加密是怎么回事"><a href="#4-Android与服务器交互的方式中的对称加密和非对称加密是怎么回事" class="headerlink" title="4.Android与服务器交互的方式中的对称加密和非对称加密是怎么回事?"></a>4.Android与服务器交互的方式中的对称加密和非对称加密是怎么回事?</h3><blockquote>
<ul>
<li>对称加密，就是加密和解密数据都是使用同一个key，这方面的算法有<code>DES</code>。 </li>
<li>非对称加密，加密和解密是使用不同的key。发送数据之前要先和服务端约定生成公钥和私钥，使用公钥加密的数据可以用私钥解密，反之。这方面的算法有<code>RSA</code>。<code>ssh</code> 和 <code>ssl</code>都是典型的非对称加密。</li>
</ul>
</blockquote>
<h3 id="5-设备横竖屏切换的时候，activity中生命周期的问题？"><a href="#5-设备横竖屏切换的时候，activity中生命周期的问题？" class="headerlink" title="5.设备横竖屏切换的时候，activity中生命周期的问题？"></a>5.设备横竖屏切换的时候，activity中生命周期的问题？</h3><blockquote>
<ul>
<li>不设置Activity的<code>android:configChanges</code>时，切屏会重新调用各个生命周期，切横屏时会执行一次，切竖屏时会执行两次 </li>
<li>设置Activity的<code>android:configChanges=”orientation”</code>时，切屏还是会重新调用各个生命周期，切横、竖屏时只会执行一次 </li>
<li>设置Activity的<code>android:configChanges=”orientation|keyboardHidden”</code>时，切屏不会重新调用各个生命周期，只会执行<code>onConfigurationChanged</code>方法</li>
</ul>
</blockquote>
<h3 id="6-Android启动Service的两种方式是什么-适用情况一般是哪些？"><a href="#6-Android启动Service的两种方式是什么-适用情况一般是哪些？" class="headerlink" title="6.Android启动Service的两种方式是什么?适用情况一般是哪些？"></a>6.Android启动Service的两种方式是什么?适用情况一般是哪些？</h3><blockquote>
<ul>
<li>如果后台服务开始后基本可以独立运行的话，可以用<code>startService</code>。音乐播放器就可以这样用。它们会一直运行直到你调用 <code>stopSelf</code>或者<code>stopService</code>。你可以通过发送Intent或者接收Intent来与正在运行的后台服务通信，但大部分时间，你只是启动服务并让它独立运行。如果你需要与后台服务通过一个持续的连接来比较频繁地通信，建议使用bind()。比如你需要定位服务不停地把更新后的地理位置传给UI。Binder比Intent开发起来复杂一些，但如果真的需要，你也只能使用它。 </li>
<li><code>startService</code>：生命周期与调用者不同。启动后若调用者未调用<code>stopService</code>而直接退出，<code>Service</code>仍会运行 </li>
<li><code>bindService</code>：生命周期与调用者绑定，调用者一旦退出，<code>Service</code>就会调用<code>unBind-&gt;onDestroy</code></li>
</ul>
</blockquote>
<h3 id="7-Android中Context一般怎么用"><a href="#7-Android中Context一般怎么用" class="headerlink" title="7.Android中Context一般怎么用?"></a>7.Android中Context一般怎么用?</h3><blockquote>
<ul>
<li>Context:包含上下文信息(外部值) 的一个参数. Android 中的 Context 分三种,<code>Application Context</code>,<code>Activity Context</code> ,<code>Service Context</code>. </li>
<li>它描述的是一个应用程序环境的信息，通过它我们可以获取应用程序的资源和类，也包括一些应用级别操作，例如：启动一个Activity，发送广播，接受Intent信息等</li>
</ul>
</blockquote>
<h3 id="8-Service的onCreate回调在UI线程中吗？"><a href="#8-Service的onCreate回调在UI线程中吗？" class="headerlink" title="8.Service的onCreate回调在UI线程中吗？"></a>8.Service的onCreate回调在UI线程中吗？</h3><blockquote>
<ul>
<li>Service生命周期的各个回调和其他的应用组件一样，是跑在主线程中，会影响到你的UI操作或者阻塞主线程中的其他事情</li>
</ul>
</blockquote>
<h3 id="9-AsyncTask的内部实现，适用的场景是？"><a href="#9-AsyncTask的内部实现，适用的场景是？" class="headerlink" title="9.AsyncTask的内部实现，适用的场景是？"></a>9.AsyncTask的内部实现，适用的场景是？</h3><blockquote>
<ul>
<li>AsyncTask内部也是Handler机制来完成的，只不过Android提供了执行框架来提供线程池来执行相应地任务，因为线程池的大小问题，所以AsyncTask只应该用来执行耗时时间较短的任务，比如HTTP请求，大规模的下载和数据库的更改不适用于AsyncTask，因为会导致线程池堵塞，没有线程来执行其他的任务，导致的情形是会发生AsyncTask根本执行不了的问题。</li>
</ul>
</blockquote>
<h3 id="10-binder机制的理解"><a href="#10-binder机制的理解" class="headerlink" title="10.binder机制的理解?"></a>10.binder机制的理解?</h3><blockquote>
<ul>
<li>binder是一种<code>IPC</code>机制,进程间通讯的一种工具. </li>
<li>Java层可以利用<code>aidl</code>工具来实现相应的接口.</li>
</ul>
</blockquote>
<h3 id="11-Android中进程间通信有哪些实现方式？"><a href="#11-Android中进程间通信有哪些实现方式？" class="headerlink" title="11.Android中进程间通信有哪些实现方式？"></a>11.Android中进程间通信有哪些实现方式？</h3><blockquote>
<ul>
<li><code>Intent</code>，<code>Binder（AIDL）</code>，<code>Messenger</code>，<code>BroadcastReceiver</code></li>
</ul>
</blockquote>
<h3 id="12-介绍下实现一个自定义view的基本流程"><a href="#12-介绍下实现一个自定义view的基本流程" class="headerlink" title="12.介绍下实现一个自定义view的基本流程"></a>12.介绍下实现一个自定义view的基本流程</h3><blockquote>
<ul>
<li>自定义View的属性 编写<code>attr.xml</code>文件 </li>
<li>在layout布局文件中引用，同时引用命名空间 </li>
<li>在View的构造方法中获得我们自定义的属性 ，在自定义控件中进行读取（构造方法拿到<code>attr.xml</code>文件值） </li>
<li>重写<code>onMesure</code></li>
<li>重写<code>onDraw</code></li>
</ul>
</blockquote>
<h3 id="13-Android中touch事件的传递机制是怎样的"><a href="#13-Android中touch事件的传递机制是怎样的" class="headerlink" title="13.Android中touch事件的传递机制是怎样的?"></a>13.Android中touch事件的传递机制是怎样的?</h3><blockquote>
<ul>
<li>Touch事件传递的相关API有<code>dispatchTouchEvent</code>、<code>onTouchEvent</code>、<code>onInterceptTouchEvent</code></li>
<li>Touch事件相关的类有<code>View</code>、<code>ViewGroup</code>、<code>Activity</code> </li>
<li>Touch事件会被封装成<code>MotionEvent</code>对象，该对象封装了手势按下、移动、松开等动作 </li>
<li>Touch事件通常从<code>Activity#dispatchTouchEvent</code>发出，只要没有被消费，会一直往下传递，到最底层的View。 </li>
<li>如果Touch事件传递到的每个View都不消费事件，那么Touch事件会反向向上传递,最终交由<code>Activity#onTouchEvent</code>处理. </li>
<li><code>onInterceptTouchEvent</code>为ViewGroup特有，可以拦截事件. </li>
<li>Down事件到来时，如果一个View没有消费该事件，那么后续的<code>MOVE/UP</code>事件都不会再给它</li>
</ul>
</blockquote>
<h3 id="14-Android多线程的实现方式有哪些"><a href="#14-Android多线程的实现方式有哪些" class="headerlink" title="14.Android多线程的实现方式有哪些?"></a>14.Android多线程的实现方式有哪些?</h3><blockquote>
<ul>
<li>Thread &amp; AsyncTask </li>
<li>Thread 可以与Loop 和 Handler 共用建立消息处理队列 </li>
<li>AsyncTask 可以作为线程池并行处理多任务</li>
</ul>
</blockquote>
<h3 id="15-Android开发中何时使用多进程？使用多进程的好处是什么？"><a href="#15-Android开发中何时使用多进程？使用多进程的好处是什么？" class="headerlink" title="15.Android开发中何时使用多进程？使用多进程的好处是什么？"></a>15.Android开发中何时使用多进程？使用多进程的好处是什么？</h3><blockquote>
<ul>
<li>要想知道如何使用多进程，先要知道Android里的多进程概念。一般情况下，一个应用程序就是一个进程，这个进程名称就是应用程序包名。我们知道进程是系统分配资源和调度的基本单位，所以每个进程都有自己独立的资源和内存空间，别的进程是不能任意访问其他进程的内存和资源的。 </li>
<li>那如何让自己的应用拥有多个进程？ </li>
<li>很简单，我们的四大组件在<code>AndroidManifest</code>文件中注册的时候，有个属性是<code>android:process</code>，<br>1.这里可以指定组件的所处的进程。默认就是应用的主进程。指定为别的进程之后，系统在启动这个组件的时候，就先创建（如果还没创建的话）这个进程，然后再创建该组件。你可以重载<code>Application</code>类的<code>onCreate</code>方法，打印出它的进程名称，就可以清楚的看见了。再设置<code>android:process</code>属性时候，有个地方需要注意：如果是<code>android:process=”:deamon”</code>，以:开头的名字，则表示这是一个应用程序的私有进程，否则它是一个全局进程。私有进程的进程名称是会在冒号前自动加上包名，而全局进程则不会。一般我们都是有私有进程，很少使用全局进程。他们的具体区别不知道有没有谁能补充一下。<br>2.使用多进程显而易见的好处就是分担主进程的内存压力。我们的应用越做越大，内存越来越多，将一些独立的组件放到不同的进程，它就不占用主进程的内存空间了。当然还有其他好处，有心人会发现Android后台进程里有很多应用是多个进程的，因为它们要常驻后台，特别是即时通讯或者社交应用，不过现在多进程已经被用烂了。典型用法是在启动一个不可见的轻量级私有进程，在后台收发消息，或者做一些耗时的事情，或者开机启动这个进程，然后做监听等。还有就是防止主进程被杀守护进程，守护进程和主进程之间相互监视，有一方被杀就重新启动它。应该还有还有其他好处，这里就不多说了。<br>3.坏处的话，多占用了系统的空间，大家都这么用的话系统内存很容易占满而导致卡顿。消耗用户的电量。应用程序架构会变复杂，应为要处理多进程之间的通信。这里又是另外一个问题了。</li>
</ul>
</blockquote>
<h3 id="16-ANR是什么？怎样避免和解决ANR"><a href="#16-ANR是什么？怎样避免和解决ANR" class="headerlink" title="16.ANR是什么？怎样避免和解决ANR?"></a>16.ANR是什么？怎样避免和解决ANR?</h3><blockquote>
<ul>
<li>ANR:<code>Application Not Responding</code>，即应用无响应 </li>
<li>ANR一般有三种类型：<br>1：<code>KeyDispatchTimeout</code>(5 seconds) –主要类型<br>按键或触摸事件在特定时间内无响应<br>2：<code>BroadcastTimeout</code>(10 seconds)<br>BroadcastReceiver在特定时间内无法处理完成<br>3：<code>ServiceTimeout</code>(20 seconds) –小概率类型<br>Service在特定的时间内无法处理完成<br>超时的原因一般有两种：<br>(1)当前的事件没有机会得到处理（UI线程正在处理前一个事件没有及时完成或者looper被某种原因阻塞住）<br>(2)当前的事件正在处理，但没有及时完成<br>UI线程尽量只做跟UI相关的工作，耗时的工作（数据库操作，I/O，连接网络或者其他可能阻碍UI线程的操作）放入单独的线程处理，尽量用Handler来处理UI thread和thread之间的交互。<br>UI线程主要包括如下：<br>Activity:<code>onCreate()</code>, <code>onResume()</code>, <code>onDestroy()</code>, <code>onKeyDown()</code>, <code>onClick()</code><br>AsyncTask: <code>onPreExecute()</code>, <code>onProgressUpdate()</code>, <code>onPostExecute()</code>, <code>onCancel()</code><br>Mainthread handler: <code>handleMessage()</code>, <code>post(runnable r)</code><br>other</li>
</ul>
</blockquote>
<h3 id="17-Android下解决滑动冲突的常见思路是什么"><a href="#17-Android下解决滑动冲突的常见思路是什么" class="headerlink" title="17.Android下解决滑动冲突的常见思路是什么?"></a>17.Android下解决滑动冲突的常见思路是什么?</h3><blockquote>
<ul>
<li>相关的滑动组件 重写<code>onInterceptTouchEvent</code>，然后判断根据xy值，来决定是否要拦截当前操作</li>
</ul>
</blockquote>
<h3 id="18-如何把一个应用设置为系统应用？"><a href="#18-如何把一个应用设置为系统应用？" class="headerlink" title="18.如何把一个应用设置为系统应用？"></a>18.如何把一个应用设置为系统应用？</h3><blockquote>
<ul>
<li>成为系统应用，首先要在 对应设备的 Android 源码 SDK 下编译，编译好之后： </li>
<li>此 Android 设备是 Debug 版本，并且已经 root，直接将此 apk 用 adb 工具 push 到 <code>system/app</code> 或 <code>system/priv-app</code> 下即可。 </li>
<li>如果非 root 设备，需要编译后重新烧写设备镜像即可。</li>
<li>有些权限(如 <code>WRITE_SECURE_SETTINGS</code> )，是不开放给第三方应用的，只能在对应设备源码中编译然后作为系统 app 使用。</li>
</ul>
</blockquote>
<h3 id="19、Android内存泄露研究"><a href="#19、Android内存泄露研究" class="headerlink" title="19、Android内存泄露研究"></a>19、Android内存泄露研究</h3><blockquote>
<ul>
<li>Android内存泄漏指的是进程中某些对象（垃圾对象）已经没有使用价值了，但是它们却可以直接或间接地引用到<code>gc roots</code>导致无法被GC回收。无用的对象占据着内存空间，使得实际可使用内存变小，形象地说法就是内存泄漏了。 </li>
<li>场景<br>类的静态变量持有大数据对象<br>静态变量长期维持到大数据对象的引用，阻止垃圾回收。<br>非静态内部类的静态实例<br>非静态内部类会维持一个到外部类实例的引用，如果非静态内部类的实例是静态的，就会间接长期维持着外部类的引用，阻止被回收掉。<br>资源对象未关闭<br>资源性对象如<code>Cursor</code>、<code>File</code>、<code>Socket</code>，应该在使用后及时关闭。未在finally中关闭，会导致异常情况下资源对象未被释放的隐患。<br>注册对象未反注册<br>未反注册会导致观察者列表里维持着对象的引用，阻止垃圾回收。<br>Handler临时性内存泄露<br>Handler通过发送Message与主线程交互，Message发出之后是存储在MessageQueue中的，有些Message也不是马上就被处理的。在Message中存在一个 target，是Handler的一个引用，如果Message在Queue中存在的时间越长，就会导致Handler无法被回收。如果Handler是非静态的，则会导致Activity或者Service不会被回收。<br>由于AsyncTask内部也是Handler机制，同样存在内存泄漏的风险。<br>此种内存泄露，一般是临时性的。</li>
</ul>
</blockquote>
<h3 id="20-内存泄露检测有什么好方法？"><a href="#20-内存泄露检测有什么好方法？" class="headerlink" title="20.内存泄露检测有什么好方法？"></a>20.内存泄露检测有什么好方法？</h3><blockquote>
<ul>
<li>检测：<br>1、<code>DDMS Heap</code>发现内存泄露<br><code>dataObject totalSize</code>的大小，是否稳定在一个范围内，如果操作程序，不断增加，说明内存泄露<br>2、使用<code>Heap Tool</code>进行内存快照前后对比<br>BlankActivity手动触发GC进行前后对比，对象是否被及时回收</li>
</ul>
</blockquote>
<h3 id="21-android-R-layout下面的布局都是什么意思？"><a href="#21-android-R-layout下面的布局都是什么意思？" class="headerlink" title="21.android.R.layout下面的布局都是什么意思？"></a>21.android.R.layout下面的布局都是什么意思？</h3><blockquote>
<ul>
<li>这是几个列表选项的布局文件。 在List声明实例化时需要传入的。<br><code>android.R.layout.simple_list_item_1</code>          列表选项的简单布局<br><code>android.R.layout.simple_expandable_list_item_2</code>  可展开列表选项的简单布局<br><code>android.R.layout.simple_list_item_checked</code>  列表被选中的选项的简单布局<br><code>android.R.layout.simple_list_item_multiple_choice</code>  可选列表的选项的简单布局 多选<br><code>android.R.layout.simple_list_item_single_choice</code>   可选列表的选项的简单布局 单选</li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="古古天" />
          <p class="site-author-name" itemprop="name">古古天</p>
           
              <p class="site-description motion-element" itemprop="description">这里是古古天的博客</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xing634325131/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/634325131" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/rick.muse.12" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://my.oschina.net/dianpaopao" title="电泡泡" target="_blank">电泡泡</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/piaomiao_hongying" title="飘渺_鸿影" target="_blank">飘渺_鸿影</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/worldmakewayfordream" title="大嘴鸟" target="_blank">大嘴鸟</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/sevenster" title="狐狸" target="_blank">狐狸</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/guogeer" title="惊奇郭" target="_blank">惊奇郭</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/kk303" title="ZZY" target="_blank">ZZY</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">古古天</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://gugutian.disqus.com/count.js" async></script>
    

    

  




	





  








  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("cqLobRdGps3RbTEb5PRuGKVp-gzGzoHsz", "y63OHEUJEd3mL6y6XjmI4upH");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
